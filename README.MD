# âš¡ Admin Canaoaves

[![Next.js](https://img.shields.io/badge/Next.js-15.3.1-black?style=flat&logo=next.js)](https://nextjs.org/)
[![Refine](https://img.shields.io/badge/Refine-5.0.1-blue?style=flat&logo=data:image/svg+xml;base64,PHN2ZyByb2xlPSJpbWciIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+UmVmaW5lPC90aXRsZT48cGF0aCBkPSJNMTMuNzg5LjQyMmE0LjAwMSA0LjAwMSAwIDAgMC0zLjU3OCAwbC04IDRBNC4wMDExIDQuMDAxMSAwIDAgMCAwIDh2OGMwIDEuNTE1Ljg1NiAyLjkgMi4yMTEgMy41NzhsOCA0YTQuMDAxIDQuMDAxIDAgMCAwIDMuNTc4IDBsOC00QTQuMDAxMSA0LjAwMTEgMCAwMCAyNCAxNlY4YzAtMS41MTUtLjg1Ni0yLjktMi4yMTEtMy41NzhsLTh6bS01LjI4OSA0YzAtMi4yMDkgMS43OTEtNCA0LTRzNCAxLjc5MSA0IDR2OGMwIDIuMjA5LTEuNzkxIDQtNCA0cy00LTEuNzkxLTQtNFY4em02IDBjMCAxLjEwNS0uODk1IDItMiAyczItLjg5NSAyLTJzLS44OTUtMi0yLTJ6Ii8+PC9zdmc+)](https://refine.dev/)
[![Supabase](https://img.shields.io/badge/Supabase-DB--F96854?style=flat&logo=supabase&logoColor=white)](https://supabase.com/)
[![shadcn/ui](https://img.shields.io/badge/shadcn/ui-000000?style=flat&logo=github&logoColor=white)](https://ui.shadcn.com/)
[![TypeScript](https://img.shields.io/badge/TypeScript-3178C6?style=flat&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Tailwind CSS](https://img.shields.io/badge/Tailwind_CSS-06B6D4?style=flat&logo=tailwindcss&logoColor=white)](https://tailwindcss.com/)
[![Vercel](https://img.shields.io/badge/Vercel-000000?style=flat&logo=vercel&logoColor=white)](https://vercel.com/)

Painel administrativo interno para o projeto **Canaoaves**, focado em moderaÃ§Ã£o de conteÃºdo, gerenciamento de usuÃ¡rios e administraÃ§Ã£o geral da plataforma.

ConstruÃ­do com **Refine** sobre **Next.js**, utilizando **Supabase** como backend e **shadcn/ui** para a interface.

### Badges da Stack

-----

## ðŸ“– Sobre o Projeto

Este painel serve como a central de controle para a plataforma Canaoaves. Sua principal responsabilidade Ã© fornecer uma interface segura para a equipe de administraÃ§Ã£o e moderaÃ§Ã£o gerenciar todos os aspectos da aplicaÃ§Ã£o, contornando as regras de RLS (Row Level Security) que sÃ£o aplicadas aos usuÃ¡rios finais.

Ele Ã© projetado para ser uma aplicaÃ§Ã£o *server-side* (usando Server Actions do Next.js) para garantir que chaves de serviÃ§o (`SERVICE_ROLE_KEY`) nunca sejam expostas ao navegador.

## âœ¨ Principais Funcionalidades

O escopo do projeto inclui:

  * **ðŸ” GestÃ£o de AutenticaÃ§Ã£o:**

      * Login exclusivo para administradores (`app_role: 'admin'`).
      * Bloqueio automÃ¡tico de usuÃ¡rios que nÃ£o possuem a role de admin.

  * **ðŸ› ï¸ Filas de ModeraÃ§Ã£o:**

      * AprovaÃ§Ã£o/RejeiÃ§Ã£o de **ReivindicaÃ§Ãµes de ServiÃ§os** (`service_ownership_claims`).
      * ModeraÃ§Ã£o e resoluÃ§Ã£o de **DenÃºncias** (`reports`).
      * AprovaÃ§Ã£o/RejeiÃ§Ã£o de **ConteÃºdo Gerado por UsuÃ¡rios** (descriÃ§Ãµes de cidades/estados, imagens).

  * **ðŸ—‚ï¸ Gerenciamento de Dados (CRUD):**

      * CRUD completo de **Perfis de UsuÃ¡rios** (`profiles`), incluindo a capacidade de alterar a `app_role`.
      * CRUD completo de **ServiÃ§os** (`services`), permitindo ediÃ§Ã£o direta pela administraÃ§Ã£o.
      * CRUD de **Taxonomia** (Categorias, Comodidades, Ofertas de ServiÃ§o).

  * **ðŸ“„ GestÃ£o de ConteÃºdo EstÃ¡tico:**

      * Editor Rich Text (WYSIWYG) para gerenciar o conteÃºdo de pÃ¡ginas como "Termos de Uso" e "PolÃ­tica de Privacidade".

## ðŸ›ï¸ Arquitetura e Acesso a Dados (RLS Bypass)

A arquitetura Ã© o pilar deste projeto. A aplicaÃ§Ã£o pÃºblica do Canaoaves usa RLS do Supabase para garantir que usuÃ¡rios sÃ³ possam ver e editar seus prÃ³prios dados. Este painel de administraÃ§Ã£o, por definiÃ§Ã£o, precisa ver e editar *todos* os dados.

Para fazer isso de forma segura, implementamos a seguinte arquitetura:

1.  **Client-side (Navegador):** Usa a chave pÃºblica `NEXT_PUBLIC_SUPABASE_ANON_KEY`. Ã‰ responsÃ¡vel apenas pela autenticaÃ§Ã£o (login) e por renderizar a UI.
2.  **Server-side (Next.js):** Usa a chave secreta `SUPABASE_SERVICE_ROLE_KEY`.
3.  **Fluxo de Dados:** Todas as operaÃ§Ãµes de dados do Refine (`getList`, `getOne`, `create`, `update`, `delete`) **nÃ£o** chamam o Supabase diretamente. Elas sÃ£o roteadas para **Next.js Server Actions**.
4.  **Server Actions:** Dentro das Server Actions, instanciamos um cliente Supabase especial (com a `SERVICE_ROLE_KEY`) que possui privilÃ©gios totais e ignora todas as regras de RLS.

Este fluxo garante que a chave de serviÃ§o (que dÃ¡ acesso total ao banco) nunca saia do ambiente seguro do servidor.

```mermaid
---
config:
  theme: default
  look: handDrawn
---
flowchart TD
    A["Admin (Browser)"] -- "1. Login (Email/Senha)" --> B(Supabase Auth);
    B -- "2. Retorna Token JWT" --> A;
    A -- "3. AÃ§Ã£o: 'Aprovar ConteÃºdo'" --> C[Refine DataProvider];
    C -- "4. Chama Server Action" --> D["Next.js Server Action (Servidor)"];
    D -- "5. Usa SUPABASE_SERVICE_ROLE_KEY" --> E(Supabase DB);
    E -- "6. Retorna dados (sem RLS)" --> D;
    D -- "7. Retorna resultado" --> C;
    C -- "8. Atualiza UI" --> A;
```

## ðŸš€ ComeÃ§ando

Siga os passos abaixo para executar o projeto localmente.

### 1\. PrÃ©-requisitos

  * Node.js (versÃ£o 20 ou superior, conforme `package.json`)
  * `npm` (ou o gerenciador de pacotes de sua escolha)
  * Acesso Ã s chaves do projeto Supabase.

### 2\. InstalaÃ§Ã£o

1.  Clone o repositÃ³rio:

    ```bash
    git clone https://github.com/SEU_USUARIO/canaoaves-admin.git
    cd canaoaves-admin
    ```

2.  Instale as dependÃªncias:

    ```bash
    npm install
    ```

### 3\. VariÃ¡veis de Ambiente

Crie um arquivo `.env.local` na raiz do projeto. VocÃª pode copiar o `.env.example` (se existir) ou criar um novo com as seguintes variÃ¡veis:

```plaintext
# URL pÃºblica do Supabase
NEXT_PUBLIC_SUPABASE_URL=https://[SEU_PROJETO].supabase.co

# Chave 'anon' (pÃºblica) do Supabase
NEXT_PUBLIC_SUPABASE_ANON_KEY=[SUA_CHAVE_ANON]

# Chave 'service_role' (secreta) do Supabase
# IMPORTANTE: NÃƒO adicione o prefixo NEXT_PUBLIC_
SUPABASE_SERVICE_ROLE_KEY=[SUA_CHAVE_SERVICE_ROLE]
```

### 4\. Executando Localmente

ApÃ³s configurar as variÃ¡veis de ambiente, inicie o servidor de desenvolvimento:

```bash
npm run dev
```

Abra [http://localhost:3000](https://www.google.com/search?q=http://localhost:3000) no seu navegador para ver a aplicaÃ§Ã£o.

## ðŸ“¦ Scripts NPM

  * `npm run dev`: Inicia o servidor de desenvolvimento.
  * `npm run build`: Gera o build de produÃ§Ã£o.
  * `npm run start`: Inicia um servidor de produÃ§Ã£o (requer `npm run build` primeiro).
  * `npm run lint`: Executa o linter (ESLint) para verificar o cÃ³digo.

## ðŸŒ Deploy

O projeto estÃ¡ configurado para deploy contÃ­nuo (CI/CD) atravÃ©s da **Vercel**.

  * **RepositÃ³rio:** `github.com/richtertech/canaoaves-admin`
  * **ProduÃ§Ã£o:** Qualquer push ou merge para a branch `main` (ou `master`) iniciarÃ¡ um novo build e deploy.
  * **DomÃ­nio:** A aplicaÃ§Ã£o de produÃ§Ã£o estÃ¡ disponÃ­vel em:
    **[https://admin.canaoaves.com.br](https://admin.canaoaves.com.br)**

As variÃ¡veis de ambiente (`NEXT_PUBLIC...` e `SUPABASE_SERVICE_ROLE_KEY`) devem ser configuradas no painel do projeto na Vercel (em **Settings -\> Environment Variables**).
