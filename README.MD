# ‚ö° Admin Canaoaves

[![Next.js](https://img.shields.io/badge/Next.js-14.2.33-black?style=flat&logo=next.js)](https://nextjs.org/)
[![Refine](https://img.shields.io/badge/Refine-5.0.6-blue?style=flat&logo=data:image/svg+xml;base64,PHN2ZyByb2xlPSJpbWciIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGU+UmVmaW5lPC90aXRsZT48cGF0aCBkPSJNMTMuNzg5LjQyMmE0LjAwMSA0LjAwMSAwIDAgMC0zLjU3OCAwbC04IDRBNC4wMDExIDQuMDAxMSAwIDAgMCAwIDh2OGMwIDEuNTE1Ljg1NiAyLjkgMi4yMTEgMy41NzhsOCA0YTQuMDAxIDQuMDAxIDAgMCAwIDMuNTc4IDBsOC00QTQuMDAxMSA0LjAwMTEgMCAwMCAyNCAxNlY4YzAtMS41MTUtLjg1Ni0yLjktMi4yMTEtMy41NzhsLTh6bS01LjI4OSA0YzAtMi4yMDkgMS43OTEtNCA0LTRzNCAxLjc5MSA0IDR2OGMwIDIuMjA5LTEuNzkxIDQtNCA0cy00LTEuNzkxLTQtNFY4em02IDBjMCAxLjEwNS0uODk1IDItMiAyczItLjg5NSAyLTJzLS44OTUtMi0yLTJ6Ii8+PC9zdmc+)](https://refine.dev/)
[![Supabase](https://img.shields.io/badge/Supabase-DB--F96854?style=flat&logo=supabase&logoColor=white)](https://supabase.com/)
[![shadcn/ui](https://img.shields.io/badge/shadcn/ui-2.4.1-000000?style=flat&logo=github&logoColor=white)](https://ui.shadcn.com/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5-3178C6?style=flat&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Tailwind CSS](https://img.shields.io/badge/Tailwind_CSS-4-06B6D4?style=flat&logo=tailwindcss&logoColor=white)](https://tailwindcss.com/)
[![Resend](https://img.shields.io/badge/Resend-Email-black?style=flat&logo=resend&logoColor=white)](https://resend.com/)
[![Vercel](https://img.shields.io/badge/Vercel-000000?style=flat&logo=vercel&logoColor=white)](https://vercel.com/canaoaves-projects/canaoaves-admin)

Painel administrativo interno para o projeto **Canaoaves**, focado em modera√ß√£o de conte√∫do, gerenciamento de usu√°rios, SEO local e comunica√ß√£o em massa.

Constru√≠do com **Refine** sobre **Next.js**, utilizando **Supabase** como backend, **Resend** para emails transacionais/marketing e **shadcn/ui** para a interface.

-----

## üìñ Sobre o Projeto

Este painel serve como a central de controle para a plataforma Canaoaves. Sua principal responsabilidade √© fornecer uma interface segura para a equipe de administra√ß√£o e modera√ß√£o gerenciar todos os aspectos da aplica√ß√£o, contornando as regras de RLS (Row Level Security) que s√£o aplicadas aos usu√°rios finais.

Ele √© projetado para ser uma aplica√ß√£o *server-side* (usando Server Actions do Next.js) para garantir que chaves de servi√ßo (`SERVICE_ROLE_KEY`) nunca sejam expostas ao navegador.

## ‚ú® Principais Funcionalidades

### üîê Gest√£o de Autentica√ß√£o e Usu√°rios
*   **Login Admin:** Acesso exclusivo para usu√°rios com `app_role: 'admin'`.
*   **Gest√£o de Perfis:** CRUD completo de usu√°rios (`profiles`), com capacidade de promover/rebaixar roles.
*   **Impersona√ß√£o (Login As):** Capacidade de administradores "logarem" como qualquer usu√°rio para prestar suporte ou verificar bugs (`src/app/actions/impersonate.ts`).
*   **Trigger de Registro:** Gerenciamento autom√°tico de cria√ß√£o de perfil via trigger `public.handle_new_user` no Supabase.

### üì¢ Comunica√ß√£o e Marketing (Novo)
*   **Broadcasts (Comunicados):** M√≥dulo dedicado para envio de emails em massa para usu√°rios (`src/app/communications`).
*   **Segmenta√ß√£o:** Filtros para enviar mensagens para todos os usu√°rios ou grupos espec√≠ficos.
*   **Integra√ß√£o Resend:** Utiliza a API da Resend para alta entregabilidade de emails (`src/app/actions/send-broadcast.ts`).

### üõ†Ô∏è Modera√ß√£o e Conte√∫do
*   **Filas de Modera√ß√£o:**
    *   Reivindica√ß√µes de Propriedade de Servi√ßo (`service_ownership_claims`).
    *   Den√∫ncias (`reports`) e Coment√°rios (`comments`).
*   **Gest√£o de Servi√ßos:** Edi√ß√£o completa de servi√ßos, ofertas e fotos.
*   **Taxonomia:** Gerenciamento de Categorias e Comodidades (Amenities).

### üåç SEO e Localiza√ß√£o
*   **Descri√ß√µes de Cidades e Estados:** M√≥dulo para criar e aprovar textos descritivos otimizados para SEO para p√°ginas de cidades (`cities`) e estados (`state-descriptions`).
*   **Imagens de Cidades:** Gest√£o de banco de imagens para capas de cidades (`city-images`).

### üìÑ Conte√∫do Institucional
*   **P√°ginas Est√°ticas:** Editor Rich Text para Termos de Uso, Pol√≠tica de Privacidade, etc (`static-content`).

## üèõÔ∏è Arquitetura e Seguran√ßa (RLS Bypass)

A arquitetura segue o padr√£o **Server Action Proxy**:

1.  **Client-side:** Autentica√ß√£o padr√£o e UI (Refine).
2.  **Server Actions:** Todas as muta√ß√µes e leituras sens√≠veis passam por Server Actions do Next.js.
3.  **Privil√©gio Elevado:** As Server Actions instanciam um cliente Supabase com `SUPABASE_SERVICE_ROLE_KEY` para ignorar RLS e executar opera√ß√µes administrativas.

```mermaid
flowchart TD
    A["Admin (Browser)"] -- "1. Login / A√ß√£o" --> B["Next.js Server Action"];
    B -- "2. Verifica Permiss√µes (Admin)" --> B;
    B -- "3. Usa SERVICE_ROLE_KEY" --> C[(Supabase DB)];
    B -- "4. Envia Email (Opcional)" --> D[Resend API];
    C -- "5. Retorna Dados" --> B;
    B -- "6. Resposta JSON" --> A;
```

## üöÄ Come√ßando

### 1. Pr√©-requisitos
*   Node.js >= 20
*   NPM

### 2. Vari√°veis de Ambiente
Crie um arquivo `.env.local` com as chaves abaixo. **Aten√ß√£o:** A chave `RESEND_API_KEY` √© crucial para o funcionamento do m√≥dulo de comunica√ß√µes.

```bash
# Supabase - Conex√£o com o Banco de Dados
NEXT_PUBLIC_SUPABASE_URL=https://[SEU_PROJETO].supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=[SUA_CHAVE_ANON]
SUPABASE_SERVICE_ROLE_KEY=[SUA_CHAVE_SERVICE_ROLE_SECRETA]

# Dom√≠nio (Cookies)
NEXT_PUBLIC_COOKIE_DOMAIN="" # Vazio para localhost

# Resend (Servi√ßo de Email)
RESEND_API_KEY=re_123456789...
```

### 3. Instala√ß√£o e Execu√ß√£o

```bash
# Instalar depend√™ncias
npm install

# Rodar servidor de desenvolvimento
npm run dev
```

Acesse [http://localhost:3000](http://localhost:3000).

## üì¶ Scripts NPM

*   `npm run dev`: Servidor de desenvolvimento.
*   `npm run build`: Build de produ√ß√£o (Refine + Next.js).
*   `npm run start`: Inicia servidor de produ√ß√£o.
*   `npm run lint`: Verifica√ß√£o de c√≥digo.
*   `npm run gen:types`: Gera tipagem TypeScript do Supabase (`src/types/database.types.ts`).

## üåê Deploy

O projeto utiliza CI/CD na **Vercel**.
*   Certifique-se de configurar a vari√°vel `RESEND_API_KEY` no painel da Vercel para que o envio de emails funcione em produ√ß√£o.
